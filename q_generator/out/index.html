<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Survey</title>
<style>
body{font-family: system-ui, -apple-system, Roboto, 'Segoe UI', Arial; padding:20px; max-width:900px; margin:auto;}
.page{display:none;}
.page.active{display:block;}
.controls{display:flex;justify-content:space-between;margin-top:18px;}
.question{margin:12px 0;padding:10px;border-radius:8px;background:#f8f8f8;}
fieldset.question{border:1px solid #ddd;padding:10px;border-radius:6px;}
.text-block{margin:8px 0;}
.page-indicator{text-align:center;margin-top:12px;color:#666}
button:disabled{opacity:.5;cursor:not-allowed}
</style>
</head><body>
<h1>Survey</h1>
<div id="pages">
<section class="page" data-index="0">
<h2>welcome</h2>
<fieldset class="question" data-q="p0_q0"><legend>Do you often feel anxious?</legend><div><input type="radio" id="p0_q0_opt0" name="p0_q0" data-sqe-value="1"> <label for="p0_q0_opt0">Yes</label></div><div><input type="radio" id="p0_q0_opt1" name="p0_q0" data-sqe-value="0"> <label for="p0_q0_opt1">No</label></div></fieldset>
<fieldset class="question" data-q="p0_q1"><legend>Do you enjoy being the center of attention?</legend><div><input type="radio" id="p0_q1_opt0" name="p0_q1" data-sqe-value="1"> <label for="p0_q1_opt0">Yes</label></div><div><input type="radio" id="p0_q1_opt1" name="p0_q1" data-sqe-value="0"> <label for="p0_q1_opt1">No</label></div></fieldset>
<fieldset class="question" data-q="p0_q2"><legend>Do you get nervous before big events?</legend><div><input type="radio" id="p0_q2_opt0" name="p0_q2" data-sqe-value="1"> <label for="p0_q2_opt0">Yes</label></div><div><input type="radio" id="p0_q2_opt1" name="p0_q2" data-sqe-value="0"> <label for="p0_q2_opt1">No</label></div></fieldset>
</section>
<section class="page" data-index="1">
<h2>results</h2>
</section>
</div>
<div class="controls">
<div><button id="prevBtn">Previous</button></div>
<div><button id="nextBtn">Next</button></div>
</div>
<div class="page-indicator" id="pageIndicator"></div>
<script>
const PAGE_COUNT = 2;
const PAGE_SCRIPTS = ["(function() {\n  if (!window.SQE_ANSWERS) window.SQE_ANSWERS = {};\n  const inputs = document.querySelectorAll(\"input[name='p0_q0']\");\n  inputs.forEach(i => {\n    i.addEventListener('change', function(e) {\n      const raw = this.dataset.sqeValue;\n      const num = Number(raw);\n      const val = (Number.isFinite(num) && raw !== '') ? num : raw;\n      window.SQE_ANSWERS[\"q1\"] = val;\n      document.dispatchEvent(new CustomEvent('sqe:answer', { detail: { id: \"q1\", value: val } }));\n    });\n  });\n}());\n(function() {\n  if (!window.SQE_ANSWERS) window.SQE_ANSWERS = {};\n  const inputs = document.querySelectorAll(\"input[name='p0_q1']\");\n  inputs.forEach(i => {\n    i.addEventListener('change', function(e) {\n      const raw = this.dataset.sqeValue;\n      const num = Number(raw);\n      const val = (Number.isFinite(num) && raw !== '') ? num : raw;\n      window.SQE_ANSWERS[\"q2\"] = val;\n      document.dispatchEvent(new CustomEvent('sqe:answer', { detail: { id: \"q2\", value: val } }));\n    });\n  });\n}());\n(function() {\n  if (!window.SQE_ANSWERS) window.SQE_ANSWERS = {};\n  const inputs = document.querySelectorAll(\"input[name='p0_q2']\");\n  inputs.forEach(i => {\n    i.addEventListener('change', function(e) {\n      const raw = this.dataset.sqeValue;\n      const num = Number(raw);\n      const val = (Number.isFinite(num) && raw !== '') ? num : raw;\n      window.SQE_ANSWERS[\"q3\"] = val;\n      document.dispatchEvent(new CustomEvent('sqe:answer', { detail: { id: \"q3\", value: val } }));\n    });\n  });\n}());","window.customCalculateResults = function(resultsDiv) {\n    if (!window.SQE_ANSWERS) {\n        resultsDiv.innerHTML = \"<p>No answers yet.</p>\";\n        return;\n    }\n\n    const a = window.SQE_ANSWERS;\n    let N = 0, E = 0;\n\n    // Neuroticism (Yes = 1 point)\n    [1,3].forEach(q => { if (parseInt(a[\"q\"+q]||0) === 1) N++; });\n\n    // Extroversion (Yes = 1 point)\n    [2].forEach(q => { if (parseInt(a[\"q\"+q]||0) === 1) E++; });\n\n    resultsDiv.innerHTML = `\n        <h3>Mini Personality Test Results</h3>\n        <ul>\n            <li><strong>Neuroticism (N):</strong> ${N}/2</li>\n            <li><strong>Extroversion (E):</strong> ${E}/1</li>\n        </ul>\n    `;\n};\n\n// ðŸ”‘ This part actually runs the function:\nconst resultsDiv = document.createElement(\"div\");\nresultsDiv.id = \"results\";\ndocument.body.appendChild(resultsDiv);\nwindow.customCalculateResults(resultsDiv);"];
document.addEventListener("DOMContentLoaded", () => {
    // tiny runtime API for f { ... } scripts
    window.SQE = window.SQE || {};
    const SQE = window.SQE;

    // insert plain text as a .text-block (escaped by using textContent)
    SQE.insert = SQE.insert || function(text) {
        const page = document.querySelector(".page.active");
        if (!page) return null;
        const div = document.createElement("div");
        div.className = "text-block";
        div.textContent = String(text);
        page.appendChild(div);
        return div;
    };

    // insert raw HTML (use with care)
    SQE.insertHTML = SQE.insertHTML || function(html) {
        const page = document.querySelector(".page.active");
        if (!page) return null;
        const div = document.createElement("div");
        div.className = "text-block";
        div.innerHTML = String(html);
        page.appendChild(div);
        return div;
    };

    SQE.getAnswer = SQE.getAnswer || function(key) {
        return (window.SQE_ANSWERS || {})[key];
    };

    SQE.setAnswer = SQE.setAnswer || function(key, val) {
        window.SQE_ANSWERS = window.SQE_ANSWERS || {};
        window.SQE_ANSWERS[key] = val;
        // dispatch the same event that choice-rendered inputs use
        document.dispatchEvent(new CustomEvent('sqe:answer', { detail: { id: key, value: val } }));
    };

    const pages = Array.from(document.querySelectorAll(".page"));
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const pageIndicator = document.getElementById("pageIndicator");

    let currentIndex = 0;
    const ran = new Array(PAGE_COUNT).fill(false);

    function runScriptForPage(idx, scriptText) {
        if (!scriptText || !scriptText.trim()) return;
        try {
            // Wrap the user's script inside an async IIFE so `await` is supported.
            // The wrapped function may return a value (string or DOM Node) or a Promise resolving to one.
            const execPromise = new Function('return (async function(){\n' + scriptText + '\n})()')();

            const handleResult = (res) => {
                try {
                    if (typeof res === 'string') {
                        SQE.insert(res);
                    } else if (res instanceof Node) {
                        const page = pages[idx];
                        if (page) page.appendChild(res);
                    } else if (res && Array.isArray(res)) {
                        // array of strings or nodes
                        res.forEach(item => {
                            if (typeof item === 'string') SQE.insert(item);
                            else if (item instanceof Node) {
                                const page = pages[idx];
                                if (page) page.appendChild(item);
                            }
                        });
                    }
                    // otherwise ignore undefined/null/other results
                } catch (e) {
                    console.error("Error handling script result for page", idx + 1, e);
                }
            };

            if (execPromise && typeof execPromise.then === 'function') {
                execPromise.then(handleResult).catch(e => {
                    console.error("Error running page script (async) for page", idx + 1, e);
                });
            } else {
                handleResult(execPromise);
            }
        } catch (e) {
            console.error("Error running page script for page", idx + 1, e);
        }
    }

    function showPage(idx) {
        if (idx < 0) idx = 0;
        if (idx >= PAGE_COUNT) idx = PAGE_COUNT - 1;
        currentIndex = idx;

        pages.forEach((p, i) => {
            if (i === idx) {
                p.classList.add("active");
                p.style.display = "";
            } else {
                p.classList.remove("active");
                p.style.display = "none";
            }
        });

        if (prevBtn) prevBtn.disabled = (idx === 0);
        if (nextBtn) nextBtn.disabled = (idx === PAGE_COUNT - 1);
        if (pageIndicator) pageIndicator.textContent = "Page " + (idx + 1) + " of " + PAGE_COUNT;

        try {
            const scriptText = PAGE_SCRIPTS[idx];
            if (!ran[idx] && scriptText && scriptText.trim().length > 0) {
                runScriptForPage(idx, scriptText);
                ran[idx] = true;
            }
        } catch (e) {
            console.error("Error running page script for page", idx + 1, e);
        }
    }

    if (prevBtn) {
        prevBtn.addEventListener("click", () => { showPage(currentIndex - 1); });
    }
    if (nextBtn) {
        nextBtn.addEventListener("click", () => { showPage(currentIndex + 1); });
    }

    showPage(0);
});
</script>
</body></html>
